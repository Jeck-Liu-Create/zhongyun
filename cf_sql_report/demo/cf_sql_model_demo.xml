<?xml version="1.0" encoding="UTF-8" ?>
<!--
# **********************
# 盛哲康虎信息技术（厦门）有限公司
# http://www.khcloud.net
# QQ: 360026606
# wechat: 360026606
# **********************
-->
<odoo noupdate="1">
    <record id="invalid_sql_view" model="cf.sql.model">
        <field name="name">Invalid SQL View</field>
        <field name="tech_name">invalid_sql</field>
        <field name="query"><![CDATA[
SELECT *
FROM my_table
ORDER BY my_field
            ]]>
        </field>
    </record>

    <record id="partner_sql_view" model="cf.sql.model">
        <field name="name">Partners Simple View</field>
        <field name="tech_name">partners_simple_view</field>
        <field name="query"><![CDATA[
SELECT
  ID,
  name as x_name,
  street as x_street,
  company_id as x_company_id
FROM res_partner
ORDER BY name
            ]]>
        </field>
    </record>

    <record id="country_state_sql_view" model="cf.sql.model">
        <field name="name">Partner count</field>
        <field name="tech_name">partner_count_country_state</field>
        <field name="is_materialized" eval="0"/>
<!--        <field name="parent_menu_id" ref=""/>-->
        <field name="notes">按国家和省（州）统计客户数</field>
        <field name="query"><![CDATA[
SELECT
    ID,                                 /*取出原表ID字段作为视图的主键，注意不能以“<i>x_</i>”开头*/
	P.name AS x_name,
	C.id AS x_m2o_country_id,           /*实现many2one关联到国家（res_country ）*/
	C.name AS x_country_name,
	C.code AS x_country_code,
	cr.name AS x_currency_name,
	s.id AS x_m2o_state_id,             /*实现many2one关联到省/州（res_country_state）*/
	s.name AS x_state_name,
	s.code AS x_state_code,
	'{"model_id": "sale.order", "relation_field": "partner_id" }' AS x_o2m_sale_orders  /*实现one2many关联到销售订单(sale.order)*/
FROM res_partner P
	LEFT JOIN res_country_state s ON P.state_id = s.id
	LEFT JOIN res_country C ON s.country_id = C.id
	LEFT JOIN res_currency cr ON C.currency_id = cr.id
ORDER BY P.id
        ]]></field>
    </record>

    <!-- 自动创建视图和odoo对象 -->
    <function model="cf.sql.model" name="button_validate_sql_expression" eval="([ref('country_state_sql_view')])"/>
    <function model="cf.sql.model" name="button_create_sql_view_and_model" eval="([ref('country_state_sql_view')])"/>
    <function model="cf.sql.model" name="button_create_ui" eval="([ref('country_state_sql_view')])"/>

</odoo>